// iiif-gallery-component v1.1.1 https://github.com/iiif-commons/iiif-gallery-component#readme
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.iiifGalleryComponent=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){var IIIFComponents,__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(IIIFComponents){var GalleryComponent=function(_super){function GalleryComponent(options){var _this=_super.call(this,options)||this;return _this._init(),_this._resize(),_this}return __extends(GalleryComponent,_super),GalleryComponent.prototype._init=function(){var _this=this,success=_super.prototype._init.call(this);success||console.error("Component failed to initialise"),this._$header=$('<div class="header"></div>'),this._$element.append(this._$header),this._$leftOptions=$('<div class="left"></div>'),this._$header.append(this._$leftOptions),this._$rightOptions=$('<div class="right"></div>'),this._$header.append(this._$rightOptions),this._$sizeDownButton=$('<input class="btn btn-default size-down" type="button" value="-" />'),this._$leftOptions.append(this._$sizeDownButton),this._$sizeRange=$('<input type="range" name="size" min="1" max="10" value="'+this.options.data.initialZoom+'" />'),this._$leftOptions.append(this._$sizeRange),this._$sizeUpButton=$('<input class="btn btn-default size-up" type="button" value="+" />'),this._$leftOptions.append(this._$sizeUpButton),this._$multiSelectOptions=$('<div class="multiSelectOptions"></div>'),this._$rightOptions.append(this._$multiSelectOptions),this._$selectAllButton=$('<div class="multiSelectAll"><input id="multiSelectAll" type="checkbox" tabindex="0" /><label for="multiSelectAll">'+this.options.data.content.selectAll+"</label></div>"),this._$multiSelectOptions.append(this._$selectAllButton),this._$selectAllButtonCheckbox=$(this._$selectAllButton.find("input:checkbox")),this._$selectButton=$('<a class="select" href="#">'+this.options.data.content.select+"</a>"),this._$multiSelectOptions.append(this._$selectButton),this._$main=$('<div class="main"></div>'),this._$element.append(this._$main),this._$thumbs=$('<div class="thumbs"></div>'),this._$main.append(this._$thumbs),this._$thumbs.addClass(this.options.data.helper.getViewingDirection().toString()),this._$sizeDownButton.on("click",function(){var val=Number(_this._$sizeRange.val())-1;val>=Number(_this._$sizeRange.attr("min"))&&(_this._$sizeRange.val(val.toString()),_this._$sizeRange.trigger("change"),_this.fire(GalleryComponent.Events.DECREASE_SIZE))}),this._$sizeUpButton.on("click",function(){var val=Number(_this._$sizeRange.val())+1;val<=Number(_this._$sizeRange.attr("max"))&&(_this._$sizeRange.val(val.toString()),_this._$sizeRange.trigger("change"),_this.fire(GalleryComponent.Events.INCREASE_SIZE))}),this._$sizeRange.on("change",function(){_this._updateThumbs(),_this._scrollToThumb(_this._getSelectedThumbIndex())}),this._$selectAllButton.checkboxButton(function(checked){checked?_this._getMultiSelectState().selectAll(!0):_this._getMultiSelectState().selectAll(!1),_this.set()}),this._$selectButton.on("click",function(){var ids=_this._getMultiSelectState().getAllSelectedCanvases().map(function(canvas){return canvas.id});_this.fire(GalleryComponent.Events.MULTISELECTION_MADE,ids)}),this._setRange(),$.templates({galleryThumbsTemplate:'                    <div class="{{:~galleryThumbClassName()}}" data-src="{{>uri}}" data-index="{{>index}}" data-visible="{{>visible}}" data-width="{{>width}}" data-height="{{>height}}" data-initialwidth="{{>initialWidth}}" data-initialheight="{{>initialHeight}}">                        <div class="wrap" style="width:{{>initialWidth}}px; height:{{>initialHeight}}px" data-link="class{merge:multiSelected toggle=\'multiSelected\'}">                        {^{if multiSelectEnabled}}                            <input id="thumb-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? \'checked\' : \'\'}" class="multiSelect" />                        {{/if}}                        </div>                        <div class="info">                            <span class="index" style="width:{{>initialWidth}}px">{{:#index + 1}}</span>                            <span class="label" style="width:{{>initialWidth}}px" title="{{>label}}">{{>label}}&nbsp;</span>                            <span class="searchResults" title="{{:~galleryThumbSearchResultsTitle()}}">{{>data.searchResults}}</span>                        </div>                    </div>'});var that=this;return $.views.helpers({galleryThumbClassName:function(){var className="thumb preLoad";return 0===this.data.index&&(className+=" first"),this.data.uri||(className+=" placeholder"),className},galleryThumbSearchResultsTitle:function(){var searchResults=Number(this.data.data.searchResults);return searchResults?searchResults>1?String.format(that.options.data.content.searchResults,searchResults):String.format(that.options.data.content.searchResult,searchResults):null}}),this._$main.on("scroll",function(){_this._updateThumbs()},this.options.data.scrollStopDuration),this.options.data.sizingEnabled||this._$sizeRange.hide(),success},GalleryComponent.prototype.data=function(){return{chunkedResizingThreshold:400,content:{searchResult:"{0} search result",searchResults:"{0} search results",select:"Select",selectAll:"Select All"},debug:!1,helper:null,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:!1,scrollStopDuration:100,searchResults:[],sizingEnabled:!0,thumbHeight:320,thumbLoadPadding:3,thumbWidth:200,viewingDirection:manifesto.ViewingDirection.leftToRight()}},GalleryComponent.prototype.set=function(){if(this._thumbs=this.options.data.helper.getThumbs(this.options.data.thumbWidth,this.options.data.thumbHeight),this.options.data.viewingDirection.toString()===manifesto.ViewingDirection.bottomToTop().toString()&&this._thumbs.reverse(),this.options.data.searchResults&&this.options.data.searchResults.length)for(var i=0;i<this.options.data.searchResults.length;i++){var searchResult=this.options.data.searchResults[i],thumb=this._thumbs.en().where(function(t){return t.index===searchResult.canvasIndex}).first(),data=$.extend(!0,{},thumb.data);data.searchResults=searchResult.rects.length,thumb.data=data}this._thumbsCache=null,this._createThumbs(),this.selectIndex(this.options.data.helper.canvasIndex);var multiSelectState=this._getMultiSelectState();if(multiSelectState.isEnabled){this._$multiSelectOptions.show(),this._$thumbs.addClass("multiSelect");for(var i=0;i<multiSelectState.canvases.length;i++){var canvas=multiSelectState.canvases[i],thumb=this._getThumbByCanvas(canvas);this._setThumbMultiSelected(thumb,canvas.multiSelected)}for(var i=0;i<multiSelectState.ranges.length;i++)for(var range=multiSelectState.ranges[i],thumbs=this._getThumbsByRange(range),i_1=0;i_1<thumbs.length;i_1++){var thumb=thumbs[i_1];this._setThumbMultiSelected(thumb,range.multiSelected)}}else this._$multiSelectOptions.hide(),this._$thumbs.removeClass("multiSelect");this._update()},GalleryComponent.prototype._update=function(){var multiSelectState=this._getMultiSelectState();if(multiSelectState.isEnabled){this._$selectAllButtonCheckbox.prop("checked",multiSelectState.allSelected());var anySelected=multiSelectState.getAll().en().where(function(t){return t.multiSelected}).toArray().length>0;anySelected?this._$selectButton.show():this._$selectButton.hide()}},GalleryComponent.prototype._getMultiSelectState=function(){return this.options.data.helper.getMultiSelectState()},GalleryComponent.prototype._createThumbs=function(){var that=this;if(this._thumbs){this._$thumbs.undelegate(".thumb","click"),this._$thumbs.empty();for(var multiSelectState=this._getMultiSelectState(),heights=[],i_2=0;i_2<this._thumbs.length;i_2++){var thumb=this._thumbs[i_2],initialWidth=thumb.width,initialHeight=thumb.height;thumb.initialWidth=initialWidth,heights.push(initialHeight),thumb.multiSelectEnabled=multiSelectState.isEnabled}for(var medianHeight=Math.median(heights),i_3=0;i_3<this._thumbs.length;i_3++){var thumb=this._thumbs[i_3];thumb.initialHeight=medianHeight}if(this._$thumbs.link($.templates.galleryThumbsTemplate,this._thumbs),multiSelectState.isEnabled)for(var thumbs=this._$thumbs.find(".thumb"),_loop_1=function(){var that_1=this_1,$thumb=$(thumbs[i]);$thumb.checkboxButton(function(checked){var thumb=$.view(this).data;that_1._setThumbMultiSelected(thumb,!thumb.multiSelected);var range=that_1.options.data.helper.getCanvasRange(thumb.data),multiSelectState=that_1._getMultiSelectState();range?multiSelectState.selectRange(range,thumb.multiSelected):multiSelectState.selectCanvas(thumb.data,thumb.multiSelected),that_1._update(),that_1.fire(GalleryComponent.Events.THUMB_MULTISELECTED,thumb)})},this_1=this,i=0;i<thumbs.length;i++)_loop_1();else this._$thumbs.delegate(".thumb","click",function(e){e.preventDefault();var thumb=$.view(this).data;that._lastThumbClickedIndex=thumb.index,that.fire(GalleryComponent.Events.THUMB_SELECTED,thumb)})}},GalleryComponent.prototype._getThumbByCanvas=function(canvas){return this._thumbs.en().where(function(c){return c.data.id===canvas.id}).first()},GalleryComponent.prototype._sizeThumb=function($thumb){var initialWidth=$thumb.data().initialwidth,initialHeight=$thumb.data().initialheight,width=Number(initialWidth),height=Number(initialHeight),newWidth=Math.floor(width*this._range),newHeight=Math.floor(height*this._range),$wrap=$thumb.find(".wrap"),$label=$thumb.find(".label"),$index=$thumb.find(".index"),$searchResults=$thumb.find(".searchResults"),newLabelWidth=newWidth;this.options.data.searchResults&&this.options.data.searchResults.length&&($searchResults.show(),newLabelWidth=newWidth-$searchResults.outerWidth(),newLabelWidth<this.options.data.minLabelWidth?($searchResults.hide(),newLabelWidth=newWidth):$searchResults.show()),this.options.data.pageModeEnabled?($index.hide(),$label.show()):($index.show(),$label.hide()),$wrap.outerWidth(newWidth),$wrap.outerHeight(newHeight),$index.outerWidth(newLabelWidth),$label.outerWidth(newLabelWidth)},GalleryComponent.prototype._loadThumb=function($thumb,cb){var $wrap=$thumb.find(".wrap");if(!$wrap.hasClass("loading")&&!$wrap.hasClass("loaded")){$thumb.removeClass("preLoad");var visible=$thumb.attr("data-visible"),fadeDuration=this.options.data.imageFadeInDuration;if("false"!==visible){$wrap.addClass("loading");var src=$thumb.attr("data-src"),$img=$('<img class="thumbImage" src="'+src+'" />');$img.hide().load(function(){$(this).fadeIn(fadeDuration,function(){$(this).parent().swapClass("loading","loaded")})}),$wrap.prepend($img),cb&&cb($img)}else $wrap.addClass("hidden")}},GalleryComponent.prototype._getThumbsByRange=function(range){for(var thumbs=[],i=0;i<this._thumbs.length;i++){var thumb=this._thumbs[i],canvas=thumb.data,r=this.options.data.helper.getCanvasRange(canvas,range.path);r&&r.id===range.id&&thumbs.push(thumb)}return thumbs},GalleryComponent.prototype._updateThumbs=function(){var debug=this.options.data.debug;this._setRange();var scrollTop=this._$main.scrollTop(),scrollHeight=this._$main.height(),scrollBottom=scrollTop+scrollHeight;debug&&console.log("scrollTop %s, scrollBottom %s",scrollTop,scrollBottom);for(var thumbs=this._getAllThumbs(),numToUpdate=0,i=0;i<thumbs.length;i++){var $thumb=$(thumbs[i]),thumbTop=$thumb.position().top,thumbHeight=$thumb.outerHeight(),thumbBottom=thumbTop+thumbHeight,padding=thumbHeight*this.options.data.thumbLoadPadding;thumbTop<=scrollBottom+padding&&thumbBottom>=scrollTop-padding?(numToUpdate+=1,this._sizeThumb($thumb),$thumb.addClass("insideScrollArea"),this._loadThumb($thumb)):$thumb.removeClass("insideScrollArea")}debug&&console.log("number of thumbs to update: "+numToUpdate)},GalleryComponent.prototype._getSelectedThumbIndex=function(){return Number(this._$selectedThumb.data("index"))},GalleryComponent.prototype._getAllThumbs=function(){return this._thumbsCache||(this._thumbsCache=this._$thumbs.find(".thumb")),this._thumbsCache},GalleryComponent.prototype._getThumbByIndex=function(canvasIndex){return this._$thumbs.find('[data-index="'+canvasIndex+'"]')},GalleryComponent.prototype._scrollToThumb=function(canvasIndex){var $thumb=this._getThumbByIndex(canvasIndex);this._$main.scrollTop($thumb.position().top)},GalleryComponent.prototype.selectIndex=function(index){this._thumbs&&this._thumbs.length&&(this._getAllThumbs().removeClass("selected"),this._$selectedThumb=this._getThumbByIndex(index),this._$selectedThumb.addClass("selected"),this._scrollToThumb(index),this._updateThumbs())},GalleryComponent.prototype._setRange=function(){var norm=Math.normalise(Number(this._$sizeRange.val()),0,10);this._range=Math.clamp(norm,.05,1)},GalleryComponent.prototype._setThumbMultiSelected=function(thumb,selected){$.observable(thumb).setProperty("multiSelected",selected)},GalleryComponent.prototype._resize=function(){},GalleryComponent}(_Components.BaseComponent);IIIFComponents.GalleryComponent=GalleryComponent}(IIIFComponents||(IIIFComponents={})),function(IIIFComponents){var GalleryComponent;!function(GalleryComponent){var Events=function(){function Events(){}return Events.DECREASE_SIZE="decreaseSize",Events.INCREASE_SIZE="increaseSize",Events.MULTISELECTION_MADE="multiSelectionMade",Events.THUMB_SELECTED="thumbSelected",Events.THUMB_MULTISELECTED="thumbMultiSelected",Events}();GalleryComponent.Events=Events}(GalleryComponent=IIIFComponents.GalleryComponent||(IIIFComponents.GalleryComponent={}))}(IIIFComponents||(IIIFComponents={})),function(g){g.IIIFComponents?g.IIIFComponents.GalleryComponent=IIIFComponents.GalleryComponent:g.IIIFComponents=IIIFComponents}(global)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});